C51 COMPILER V8.05a   LEDCUBE                                                              11/06/2018 21:33:31 PAGE 1   


C51 COMPILER V8.05a, COMPILATION OF MODULE LEDCUBE
OBJECT MODULE PLACED IN ledcube.OBJ
COMPILER INVOKED BY: d:\Keil_c51\C51\BIN\C51.EXE ledcube.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "STC12C5A60S2.H"
   2          #include<intrins.h>
   3          #include"move.h"
   4          #include"FFT.H"                  //FFT(¿ìËÙ¸µÀïÒ¶±ä»»)¹¦ÄÜÍ·ÎÄ¼þ
   5          #define u8 unsigned char 
   6          #define u16 unsigned int
   7          sbit ST=P4^5;
   8          sbit DAT=P3^7;
   9          sbit SH=P4^6;
  10          sbit KEY1=P3^2;
  11          sbit KEY2=P3^3;
  12          sbit KEY3=P3^4;
  13          unsigned int tim0=0,tim1=0;
  14          unsigned char ADC_Count=0,LINE=15,G=0,T,flag=1;
  15          unsigned char code cen[8]={0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80};
  16          //unsigned char code cen[8]={0x80,0x40,0x20,0x10,0x08,0x04,0x02,0x01};
  17          unsigned char code tablew[]={0x80,0xC0,0xE0,0xF0,0xF8,0xFC,0xFE,0xFF}; 
  18          unsigned char buffer[8];
  19          void delay(unsigned int x)
  20          {
  21   1        unsigned char y;
  22   1        for(x;x;x--)
  23   1         for(y=110;y;y--);
  24   1      }
  25          void hc595(unsigned char dat)
  26          {
  27   1        unsigned char i;
  28   1        for(i=0;i<8;i++)
  29   1        {
  30   2           if((dat<<i)&0x80)
  31   2               DAT=1;
  32   2               else
  33   2               DAT=0;
  34   2               SH=0;
  35   2               //_nop_();
  36   2               SH=1;
  37   2        }  
  38   1      }
  39          void hc595out()
  40          {
  41   1        ST=0;
  42   1        ST=1;
  43   1      }
  44          void gaodu(u8 high)//
  45          {
  46   1          u8 i;
  47   1              for(i=0;i<8;i++)
  48   1          hc595(high);           //·¢ËÍ¶ÎÑ¡Êý¾Ý
  49   1              hc595out();
  50   1      }
  51          void display(u16 time,u8 dat)
  52          {
  53   1        unsigned char x,y,z;
  54   1        TR0=1;
  55   1        TR1=1;
C51 COMPILER V8.05a   LEDCUBE                                                              11/06/2018 21:33:31 PAGE 2   

  56   1        for(z=0;z<1;z++)
  57   1        {
  58   2          while(tim1<time)
  59   2              {
  60   3                      for(y=0;y<8;y++)
  61   3                      {
  62   4                        tim0=0;
  63   4                        for(x=0;x<8;x++)
  64   4                        {
  65   5                         hc595(dat);
  66   5                        }
  67   4                        hc595out();
  68   4                        while(tim0<2)
  69   4                        {
  70   5                                P2=cen[7-y];
  71   5                                delay(2);
  72   5                                P2=0x00;
  73   5                        }  
  74   4                      }
  75   3              }
  76   2              tim1=0;
  77   2        }
  78   1        TR0=0;
  79   1        TR1=0;
  80   1      }
  81          void display_yanhua(u16 time,u8 yiwei)
  82          {
  83   1        unsigned char x,y,z;
  84   1        u16 light;
  85   1        TR0=1;
  86   1        TR1=1;
  87   1        for(z=0;z<6;z++)
  88   1        {
  89   2          while(tim1<100)
  90   2              {
  91   3                      for(y=0;y<8;y++)
  92   3                      {
  93   4                        tim0=0;
  94   4                        for(x=0;x<8;x++)
  95   4                        {
  96   5                         hc595(yanhua[0][y][x]<<yiwei);
  97   5                        }
  98   4                        hc595out();
  99   4                        while(tim0<2)
 100   4                        {
 101   5                                P2=cen[y]>>(7-z);
 102   5                                delay(2);
 103   5                                P2=0x00;
 104   5                        }  
 105   4                      }
 106   3              }
 107   2              tim1=0;
 108   2        }
 109   1        for(z=1;z<6;z++)
 110   1        {
 111   2          while(tim1<time)
 112   2              {
 113   3                      for(y=0;y<8;y++)
 114   3                      {
 115   4                        tim0=0;
 116   4                        for(x=0;x<8;x++)
 117   4                        {
C51 COMPILER V8.05a   LEDCUBE                                                              11/06/2018 21:33:31 PAGE 3   

 118   5                         hc595(yanhua[z][y][x]<<yiwei);
 119   5                        }
 120   4                        hc595out();
 121   4                        while(tim0<2)
 122   4                        {
 123   5                                P2=cen[7-y];
 124   5                    for(light=(6-z)*80;light;light--);
 125   5                                P2=0x00;
 126   5                                for(light=z*100;light;light--);
 127   5                        }  
 128   4                      }
 129   3              }
 130   2              tim1=0;
 131   2        }
 132   1        TR0=0;
 133   1        TR1=0;
 134   1      }
 135          void displaycube(u16 time)
 136          {
 137   1        unsigned char x,y,z;
 138   1        TR0=1;
 139   1        TR1=1;
 140   1        for(z=0;z<26;z++)
 141   1        {
 142   2          while(tim1<time)
 143   2              {
 144   3                      for(y=0;y<8;y++)
 145   3                      {
 146   4                        tim0=0;
 147   4                        for(x=0;x<8;x++)
 148   4                        {
 149   5                         hc595(cube[z][y][x]);
 150   5                        }
 151   4                        hc595out();
 152   4                        while(tim0<2)
 153   4                        {
 154   5                                P2=cen[7-y];
 155   5                                delay(2);
 156   5                                P2=0x00;
 157   5                        }  
 158   4                      }
 159   3              }
 160   2              tim1=0;
 161   2        }
 162   1        TR0=0;
 163   1        TR1=0;
 164   1      }
 165          void displaycube2(u16 time)
 166          {
 167   1        unsigned char x,y,z;
 168   1        TR0=1;
 169   1        TR1=1;
 170   1        for(z=0;z<8;z++)
 171   1        {
 172   2          while(tim1<time)
 173   2              {
 174   3                      for(y=0;y<8;y++)
 175   3                      {
 176   4                        tim0=0;
 177   4                        for(x=0;x<8;x++)
 178   4                        {
 179   5                         hc595(cube2[z][y][x]);
C51 COMPILER V8.05a   LEDCUBE                                                              11/06/2018 21:33:31 PAGE 4   

 180   5                        }
 181   4                        hc595out();
 182   4                        while(tim0<2)
 183   4                        {
 184   5                                P2=cen[7-y];
 185   5                                delay(2);
 186   5                                P2=0x00;
 187   5                        }  
 188   4                      }
 189   3              }
 190   2              tim1=0;
 191   2        }
 192   1        TR0=0;
 193   1        TR1=0;
 194   1      }
 195          void displaysnow()
 196          {
 197   1        unsigned char x,y,z;
 198   1        TR0=1;
 199   1        TR1=1;
 200   1        for(z=0;z<14;z++)
 201   1        {
 202   2          while(tim1<50)
 203   2              {
 204   3                      for(y=0;y<8;y++)
 205   3                      {
 206   4                        tim0=0;
 207   4                        for(x=0;x<8;x++)
 208   4                        {
 209   5                         hc595(snow[z][y][x]);
 210   5                        }
 211   4                        hc595out();
 212   4                        while(tim0<2)
 213   4                        {
 214   5                                P2=cen[7-y];
 215   5                                delay(2);
 216   5                                P2=0x00;
 217   5                        }  
 218   4                      }
 219   3              }
 220   2              tim1=0;
 221   2        }
 222   1        TR0=0;
 223   1        TR1=0;
 224   1      }
 225          
 226          void displayy_table()
 227          {
 228   1        unsigned char x,y,z;
 229   1        TR0=1;
 230   1        TR1=1;
 231   1        for(z=0;z<6;z++)
 232   1        {
 233   2          while(tim1<200)
 234   2              {
 235   3                      for(y=0;y<8;y++)
 236   3                      {
 237   4                        tim0=0;
 238   4                        for(x=0;x<8;x++)
 239   4                        {
 240   5                         hc595(y_table[z][y][x]);
 241   5                        }
C51 COMPILER V8.05a   LEDCUBE                                                              11/06/2018 21:33:31 PAGE 5   

 242   4                        hc595out();
 243   4                        while(tim0<2)
 244   4                        {
 245   5                                P2=cen[7-y];
 246   5                                delay(2);
 247   5                                P2=0x00;
 248   5                        }  
 249   4                      }
 250   3              }
 251   2              tim1=0;
 252   2        }
 253   1        TR0=0;
 254   1        TR1=0;
 255   1      }
 256          
 257          
 258          void displayhart_table(shu)
 259          {
 260   1        unsigned char x,y,z;
 261   1        TR0=1;
 262   1        TR1=1;
 263   1        for(z=0;z<2;z++)
 264   1        {
 265   2          while(tim1<shu*10)
 266   2              {
 267   3                      for(y=0;y<8;y++)
 268   3                      {
 269   4                        tim0=0;
 270   4                        for(x=0;x<8;x++)
 271   4                        {
 272   5                         hc595(hart_table[z][y][x]);
 273   5                        }
 274   4                        hc595out();
 275   4                        while(tim0<2)
 276   4                        {
 277   5                                P2=cen[y];
 278   5                                delay(2);
 279   5                                P2=0x00;
 280   5                        }  
 281   4                      }
 282   3              }
 283   2              tim1=0;
 284   2        }
 285   1        TR0=0;
 286   1        TR1=0;
 287   1      }
 288          void displaysin_cube_table()
 289          {
 290   1        unsigned char x,y,z;
 291   1        TR0=1;
 292   1        TR1=1;
 293   1        for(z=0;z<14;z++)
 294   1        {
 295   2          while(tim1<60)
 296   2              {
 297   3                      for(y=0;y<8;y++)
 298   3                      {
 299   4                        tim0=0;
 300   4                        for(x=0;x<8;x++)
 301   4                        {
 302   5                         hc595(sin_cube_table[z][y][x]);
 303   5                        }
C51 COMPILER V8.05a   LEDCUBE                                                              11/06/2018 21:33:31 PAGE 6   

 304   4                        hc595out();
 305   4                        while(tim0<2)
 306   4                        {
 307   5                                P2=cen[y];
 308   5                                delay(2);
 309   5                                P2=0x00;
 310   5                        }  
 311   4                      }
 312   3              }
 313   2              tim1=0;
 314   2        }
 315   1        TR0=0;
 316   1        TR1=0;
 317   1      }
 318          void displayx_table()
 319          {
 320   1        unsigned char x,y,z;
 321   1        TR0=1;
 322   1        TR1=1;
 323   1        for(z=0;z<6;z++)
 324   1        {
 325   2          while(tim1<200)
 326   2              {
 327   3                      for(y=0;y<8;y++)
 328   3                      {
 329   4                        tim0=0;
 330   4                        for(x=0;x<8;x++)
 331   4                        {
 332   5                         hc595(x_table[z][y][x]);
 333   5                        }
 334   4                        hc595out();
 335   4                        while(tim0<2)
 336   4                        {
 337   5                                P2=cen[y];
 338   5                                delay(2);
 339   5                                P2=0x00;
 340   5                        }  
 341   4                      }
 342   3              }
 343   2              tim1=0;
 344   2        }
 345   1        TR0=0;
 346   1        TR1=0;
 347   1      }
 348          void displayz_table()
 349          {
 350   1        unsigned char x,y,z;
 351   1        TR0=1;
 352   1        TR1=1;
 353   1        for(z=0;z<6;z++)
 354   1        {
 355   2          while(tim1<200)
 356   2              {
 357   3                      for(y=0;y<8;y++)
 358   3                      {
 359   4                        tim0=0;
 360   4                        for(x=0;x<8;x++)
 361   4                        {
 362   5                         hc595(z_table[z][y][x]);
 363   5                        }
 364   4                        hc595out();
 365   4                        while(tim0<2)
C51 COMPILER V8.05a   LEDCUBE                                                              11/06/2018 21:33:31 PAGE 7   

 366   4                        {
 367   5                                P2=cen[y];
 368   5                                delay(2);
 369   5                                P2=0x00;
 370   5                        }  
 371   4                      }
 372   3              }
 373   2              tim1=0;
 374   2        }
 375   1        TR0=0;
 376   1        TR1=0;
 377   1      }
 378          
 379          void displayyx_table()
 380          {
 381   1        unsigned char x,y,z;
 382   1        TR0=1;
 383   1        TR1=1;
 384   1        for(z=0;z<26;z++)
 385   1        {
 386   2          while(tim1<200)
 387   2              {
 388   3                      for(y=0;y<8;y++)
 389   3                      {
 390   4                        tim0=0;
 391   4                        for(x=0;x<8;x++)
 392   4                        {
 393   5                         hc595(yx_table[z][y][x]);
 394   5                        }
 395   4                        hc595out();
 396   4                        while(tim0<2)
 397   4                        {
 398   5                                P2=cen[y];
 399   5                                delay(2);
 400   5                                P2=0x00;
 401   5                        }  
 402   4                      }
 403   3              }
 404   2              tim1=0;
 405   2        }
 406   1        TR0=0;
 407   1        TR1=0;
 408   1      }
 409          
 410          void displayxz_table()
 411          {
 412   1        unsigned char x,y,z;
 413   1        TR0=1;
 414   1        TR1=1;
 415   1        for(z=0;z<26;z++)
 416   1        {
 417   2          while(tim1<200)
 418   2              {
 419   3                      for(y=0;y<8;y++)
 420   3                      {
 421   4                        tim0=0;
 422   4                        for(x=0;x<8;x++)
 423   4                        {
 424   5                         hc595(xz_table[z][y][x]);
 425   5                        }
 426   4                        hc595out();
 427   4                        while(tim0<2)
C51 COMPILER V8.05a   LEDCUBE                                                              11/06/2018 21:33:31 PAGE 8   

 428   4                        {
 429   5                                P2=cen[y];
 430   5                                delay(2);
 431   5                                P2=0x00;
 432   5                        }  
 433   4                      }
 434   3              }
 435   2              tim1=0;
 436   2        }
 437   1        TR0=0;
 438   1        TR1=0;
 439   1      }
 440          
 441          void displaybianxing()
 442          {
 443   1        unsigned char x,y,z;
 444   1        TR0=1;
 445   1        TR1=1;
 446   1        for(z=0;z<11;z++)
 447   1        {
 448   2          while(tim1<200)
 449   2              {
 450   3                      for(y=0;y<8;y++)
 451   3                      {
 452   4                        tim0=0;
 453   4                        for(x=0;x<8;x++)
 454   4                        {
 455   5                         hc595(bianxing[z][y][x]);
 456   5                        }
 457   4                        hc595out();
 458   4                        while(tim0<2)
 459   4                        {
 460   5                                P2=cen[y];
 461   5                                delay(2);
 462   5                                P2=0x00;
 463   5                        }  
 464   4                      }
 465   3              }
 466   2              tim1=0;
 467   2        }
 468   1        TR0=0;
 469   1        TR1=0;
 470   1      }
 471          void displayshandian()
 472          {
 473   1        unsigned char x,y,z;
 474   1        TR0=1;
 475   1        TR1=1;
 476   1        for(z=0;z<22;z++)
 477   1        {
 478   2          while(tim1<100)
 479   2              {
 480   3                      for(y=0;y<8;y++)
 481   3                      {
 482   4                        tim0=0;
 483   4                        for(x=0;x<8;x++)
 484   4                        {
 485   5                        
 486   5                        hc595(shandian[z][y][x]);
 487   5                        }
 488   4                        hc595out();
 489   4                        while(tim0<2)
C51 COMPILER V8.05a   LEDCUBE                                                              11/06/2018 21:33:31 PAGE 9   

 490   4                        {
 491   5                                P2=cen[7-y];
 492   5                                delay(2);
 493   5                                P2=0x00;
 494   5                        }  
 495   4                      }
 496   3              }
 497   2              tim1=0;
 498   2        }
 499   1        TR0=0;
 500   1        TR1=0;
 501   1      }
 502          void displayrain()
 503          {
 504   1        unsigned char x,y,z;
 505   1        TR0=1;
 506   1        TR1=1;
 507   1        for(z=0;z<8;z++)
 508   1        {
 509   2          while(tim1<60)
 510   2              {
 511   3                      for(y=0;y<8;y++)
 512   3                      {
 513   4                        tim0=0;
 514   4                        for(x=0;x<8;x++)
 515   4                        {
 516   5                        
 517   5                         hc595(rain[0][y][x]);
 518   5                        }
 519   4                        hc595out();
 520   4                        while(tim0<2)
 521   4                        {
 522   5                                P2=_crol_(cen[y],(7-z));
 523   5                                delay(2);
 524   5                                P2=0x00;
 525   5                        }  
 526   4                      }
 527   3              }
 528   2              tim1=0;
 529   2        }
 530   1        TR0=0;
 531   1        TR1=0;
 532   1      }
 533          void displayloudou(u16 time)
 534          {
 535   1        unsigned char x,y,z;
 536   1        TR0=1;
 537   1        TR1=1;
 538   1        for(z=0;z<8;z++)
 539   1        {
 540   2          while(tim1<time)
 541   2              {
 542   3                      for(y=0;y<8;y++)
 543   3                      {
 544   4                        tim0=0;
 545   4                        for(x=0;x<8;x++)
 546   4                        {
 547   5                         hc595(king[7-z][7-y][x]);
 548   5                        }
 549   4                        hc595out();
 550   4                        while(tim0<2)
 551   4                        {
C51 COMPILER V8.05a   LEDCUBE                                                              11/06/2018 21:33:31 PAGE 10  

 552   5                                P2=cen[7-y];
 553   5                                delay(2);
 554   5                                P2=0x00;
 555   5                        }  
 556   4                      }
 557   3              }
 558   2              tim1=0;
 559   2        }
 560   1        TR0=0;
 561   1        TR1=0;
 562   1      }
 563          void displayking()
 564          {
 565   1        u8 x,y,z,i=0,j=0,num;
 566   1        u8 Cube[8][8];
 567   1        for(x=0;x<8;x++)
 568   1          for(y=0;y<8;y++)
 569   1                Cube[x][y]=0x00;
 570   1        TR0=1;
 571   1        TR1=1;
 572   1        for(i=0;i<8;i++)
 573   1        {
 574   2          if(i<4)z=-8*i+28;
 575   2              else z=8*i-28;
 576   2              j=i;
 577   2              for(num=0;num<z;num++)
 578   2              {
 579   3                if(i<4)
 580   3                {
 581   4                        switch(num/(z/4))
 582   4                    {
 583   5                          case 0:{Cube[i][j]|=Cube[i][j]>>1|cen[7-i];}break;
 584   5                              case 1:{Cube[i][j++]|=cen[i];}break;
 585   5                              case 2:{Cube[i][7-i]|=Cube[i][7-i]<<1|cen[i];}break;
 586   5                              case 3:{Cube[i][j]|=Cube[i][j]|cen[7-i];j--;}break;
 587   5                        }
 588   4                }
 589   3                else
 590   3                {
 591   4                        switch(num/(z/4))
 592   4                    { 
 593   5                          case 0:{Cube[i][7-j]|=Cube[i][7-i]>>1|cen[i];}break;
 594   5                              case 1:{Cube[i][7-j]|=cen[7-i];j--;}break;
 595   5                              case 2:{Cube[i][i]|=Cube[i][i]<<1|cen[7-i];}break;
 596   5                          case 3:{Cube[i][7-j]|=Cube[i][7-j]|cen[i];j++;}break;                       
 597   5                        }
 598   4                }
 599   3                      
 600   3                  while(tim1<80)
 601   3                      {
 602   4                              for(y=0;y<8;y++)
 603   4                              {
 604   5                                tim0=0;
 605   5                                for(x=0;x<8;x++)
 606   5                                {
 607   6                                 hc595(Cube[y][x]);
 608   6                                }
 609   5                                hc595out();
 610   5                                while(tim0<2)
 611   5                                {
 612   6                                        P2=cen[y];
 613   6                                        delay(2);
C51 COMPILER V8.05a   LEDCUBE                                                              11/06/2018 21:33:31 PAGE 11  

 614   6                                        P2=0x00;
 615   6                                }  
 616   5                              }
 617   4                      }
 618   3                      tim1=0;
 619   3                }
 620   2        }
 621   1        TR0=0;
 622   1        TR1=0;
 623   1      }
 624          
 625          void displaywater(u16 time)
 626          {
 627   1        unsigned char x,y,z;
 628   1        TR0=1;
 629   1        TR1=1;
 630   1        for(z=0;z<8;z++)
 631   1        {
 632   2          while(tim1<time)
 633   2              {
 634   3                      for(y=0;y<8;y++)
 635   3                      {
 636   4                        tim0=0;
 637   4                        for(x=0;x<8;x++)
 638   4                        {
 639   5                         hc595(water[0][y][x]);
 640   5                        }
 641   4                        hc595out();
 642   4                        while(tim0<2)
 643   4                        {
 644   5                                P2=cen[y]<<(7-z);
 645   5                                delay(2);
 646   5                                P2=0x00;
 647   5                        }  
 648   4                      }
 649   3              }
 650   2              tim1=0;
 651   2        }
 652   1        for(z=1;z<6;z++)
 653   1        {
 654   2          while(tim1<time)
 655   2              {
 656   3                      for(y=0;y<8;y++)
 657   3                      {
 658   4                        tim0=0;
 659   4                        for(x=0;x<8;x++)
 660   4                        {
 661   5                         hc595(water[z][y][x]);
 662   5                        }
 663   4                        hc595out();
 664   4                        while(tim0<2)
 665   4                        {
 666   5                                P2=cen[7-y];
 667   5                                delay(2);
 668   5                                P2=0x00;
 669   5                        }  
 670   4                      }
 671   3              }
 672   2              tim1=0;
 673   2        }
 674   1        TR0=0;
 675   1        TR1=0;
C51 COMPILER V8.05a   LEDCUBE                                                              11/06/2018 21:33:31 PAGE 12  

 676   1      }
 677          
 678          void displaywater_1()
 679          {
 680   1        unsigned char x,y,z;
 681   1        TR0=1;
 682   1        TR1=1;
 683   1         for(z=0;z<8;z++)
 684   1        {
 685   2          while(tim1<150)
 686   2              {
 687   3                      for(y=0;y<8;y++)
 688   3                      {
 689   4                        tim0=0;
 690   4                        for(x=0;x<8;x++)
 691   4                        {
 692   5                         //hc595(0xff);
 693   5                         hc595(water_1[0][y][x]);
 694   5                        }
 695   4                        hc595out();
 696   4                        while(tim0<2)
 697   4                        {
 698   5                                P2=cen[y]<<(7-z);
 699   5                                delay(2);
 700   5                                P2=0x00;
 701   5                        }  
 702   4                      }
 703   3              }
 704   2              tim1=0;
 705   2        }
 706   1        for(z=1;z<6;z++)
 707   1        {
 708   2          while(tim1<300)
 709   2              {
 710   3                      for(y=0;y<8;y++)
 711   3                      {
 712   4                        tim0=0;
 713   4                        for(x=0;x<8;x++)
 714   4                        {
 715   5                         //hc595(0xff);
 716   5                         hc595(water_1[z][y][x]);
 717   5                        }
 718   4                        hc595out();
 719   4                        while(tim0<2)
 720   4                        {
 721   5                                P2=cen[7-y];
 722   5                                delay(2);
 723   5                                P2=0x00;
 724   5                        }  
 725   4                      }
 726   3              }
 727   2              tim1=0;
 728   2        }
 729   1        TR0=0;
 730   1        TR1=0;
 731   1      }
 732          void displayIVU_1()
 733          {
 734   1        unsigned char x,y,z;
 735   1        TR0=1;
 736   1        TR1=1;
 737   1        for(z=0;z<21;z++)
C51 COMPILER V8.05a   LEDCUBE                                                              11/06/2018 21:33:31 PAGE 13  

 738   1        {
 739   2          if((z+1)%7==0)
 740   2              {
 741   3              while(tim1<=300)
 742   3              {
 743   4                      for(y=0;y<8;y++)
 744   4                      {
 745   5                        tim0=0;
 746   5                        for(x=0;x<8;x++)
 747   5                        {
 748   6                         hc595(IVU_1[z][y][x]);
 749   6                        }
 750   5                        hc595out();
 751   5                        while(tim0<2)
 752   5                        {
 753   6                                P2=cen[7-y];
 754   6                                delay(2);
 755   6                                P2=0x00;
 756   6                        }  
 757   5                      }
 758   4              }
 759   3              tim1=0;
 760   3              }
 761   2              else
 762   2              {
 763   3          while(tim1<=100)
 764   3              {
 765   4                      for(y=0;y<8;y++)
 766   4                      {
 767   5                        tim0=0;
 768   5                        for(x=0;x<8;x++)
 769   5                        {
 770   6                         hc595(IVU_1[z][y][x]);
 771   6                        }
 772   5                        hc595out();
 773   5                        while(tim0<2)
 774   5                        {
 775   6                                P2=cen[7-y];
 776   6                                delay(2);
 777   6                                P2=0x00;
 778   6                        }  
 779   5                      }
 780   4              }
 781   3              tim1=0;
 782   3              }
 783   2        }
 784   1        TR0=0;
 785   1        TR1=0;
 786   1      }
 787          void display_LCX()
 788          {
 789   1       unsigned char x,y,z;
 790   1        TR0=1;
 791   1        TR1=1;
 792   1        for(z=0;z<27;z++)
 793   1        {
 794   2          while(tim1<150)
 795   2              {
 796   3                      for(y=0;y<8;y++)
 797   3                      {
 798   4                        tim0=0;
 799   4                        for(x=0;x<8;x++)
C51 COMPILER V8.05a   LEDCUBE                                                              11/06/2018 21:33:31 PAGE 14  

 800   4                        {
 801   5                         hc595(LCX[z][y][x]);
 802   5                        }
 803   4                        hc595out();
 804   4                        while(tim0<2)
 805   4                        {
 806   5                                P2=cen[7-y];
 807   5                                delay(2);
 808   5                                P2=0x00;
 809   5                        }  
 810   4                      }
 811   3              }
 812   2              tim1=0;
 813   2        }
 814   1        TR0=0;
 815   1        TR1=0;
 816   1      }
 817          void interinit()
 818          {
 819   1        TMOD=0x11;
 820   1        TH0=(65536-2000)/256;
 821   1        TL0=(65536-2000)%256;
 822   1        TH1=(65536-2000)/256;
 823   1        TL1=(65536-2000)%256;
 824   1        ET0=1;
 825   1        ET1=1;
 826   1        TR0=0;
 827   1        TR1=0;
 828   1        IPH = PADCH;
 829   1        IP  = PADC;                     //ÖÐ¶ÏÓÅÏÈ¼¶
 830   1        EA=1;
 831   1        P1ASF  = 0x03;          //0000,0010, ½« P1.1 ÖÃ³ÉÄ£Äâ¿Ú
 832   1        AUXR1 &=0xFB;           //1111,1011, Áî ADRJ=0
 833   1        EADC   =1;                            //ADÖÐ¶Ï´ò¿ª
 834   1        ADC_CONTR = ADC_POWER | ADC_SPEEDHH | ADC_START | channel; //1110 1001   1´ò¿ª A/D £¨ADC_POWER£©×ª»»µçÔ´
             -£»11ËÙ¶ÈÎª90ÖÜÆÚÒ»´Î£»
 835   1                                                                             //0ÖÐ¶Ï±êÖ¾ÇåÁã£»1Æô¶¯adc(ADC_START);001ADÍ¨µÀ´ò¿ª£¨
             -ÕâÀïÎªP1.1£©;
 836   1      }
 837          void main()
 838          {  
 839   1         unsigned char shu,i;           
 840   1         interinit();
 841   1      //   P2M0 = 0xff;
 842   1      //   P2M1 = 0x00;
 843   1      //   P3M0 = 0x80;
 844   1      //   P3M1 = 0x00;
 845   1      //   P4M0 = 0xff;
 846   1      //   P4M1 = 0x00;
 847   1      
 848   1      
 849   1         P2=0x00;
 850   1         gaodu(0x00);
 851   1         TR0=1; 
 852   1         while(tim0<10000)
 853   1         {
 854   2                 if(KEY1==0)
 855   2                 {
 856   3                   flag=1;
 857   3                   break;
 858   3                 }
 859   2                 if(KEY2==0)
C51 COMPILER V8.05a   LEDCUBE                                                              11/06/2018 21:33:31 PAGE 15  

 860   2                 {
 861   3                   flag=2;
 862   3                   TMOD = 0x12; //T0: 8Î»×Ô¶¯ÖØ×°      T1: 16Î»Ä£Ê½
 863   3                       TH0  = 0x70; //ADC²ÉÑùÖÜÆÚ£¨80us»ò6.66us£©  ²ÉÑùÂÊ 12.5 KHz                                                              
 864   3                       TL0  = 0x70; //
 865   3                       TH1  = 0xfd; //Ë¢ÐÂÏÔÊ¾ÖÜÆÚ£¨300us»ò25us£©     Ë¢ÐÂÂÊ                                                                             
 866   3                       TL1  = 0Xa8; //
 867   3                       EADC = 1;        //¿ªÆôADC 
 868   3                       TR1   = 1; //Ë¢ÐÂÏÔÊ¾
 869   3                       TR0   = 1; //¿ØÖÆ²ÉÑùËÙÂÊ
 870   3                       ADC_Count=0;
 871   3                       break;
 872   3                 }
 873   2                 if(KEY3==0)
 874   2                 {
 875   3                   flag=3;
 876   3                   break;
 877   3                 }
 878   2                 else
 879   2                 flag=1;
 880   2         }
 881   1         TR0=0;
 882   1         tim0=0;
 883   1         while(1)
 884   1         {
 885   2                 while(flag==3)
 886   2                 {        
 887   3                      //display(1000,0xff);
 888   3                      displaywater_1();
 889   3                 }
 890   2                 while(flag==1)
 891   2                 {
 892   3                      displayking();
 893   3                              displayloudou(200);
 894   3                          displaycube(200);
 895   3                          display(1000,0xff);
 896   3                              displaycube2(200);
 897   3                              display(300,0x00);
 898   3                          displayIVU_1();
 899   3                              display_LCX();
 900   3                          displayshandian();
 901   3                          for(shu=0;shu<5;shu++)
 902   3                         {
 903   4                           displaysnow();
 904   4                         }
 905   3                         for(shu=20;shu>10;shu--)
 906   3                         {
 907   4                           displayhart_table(shu);
 908   4                         }
 909   3                         display_yanhua(100,2);
 910   3                         display_yanhua(100,1);
 911   3                         display_yanhua(100,0);
 912   3                         for(shu=0;shu<3;shu++)
 913   3                         {
 914   4                         displaywater_1();
 915   4                         }
 916   3                         displaywater(100);
 917   3                         displaywater(100);
 918   3                         for(shu=0;shu<5;shu++)
 919   3                         {
 920   4                         displayrain();
 921   4                         }
C51 COMPILER V8.05a   LEDCUBE                                                              11/06/2018 21:33:31 PAGE 16  

 922   3                          for(shu=5;shu>0;shu--)
 923   3                         { 
 924   4                         displaysin_cube_table();
 925   4                         }   
 926   3                          
 927   3                         displayxz_table();
 928   3                         displayyx_table(); 
 929   3                              for(shu=2;shu>0;shu--)
 930   3                         { 
 931   4                         displayx_table();
 932   4                         displayy_table();
 933   4                         displayz_table(); 
 934   4                         } 
 935   3                         displaybianxing();
 936   3                         display(1000,0x00);
 937   3                 }
 938   2                 while(flag==2)
 939   2                 {
 940   3                          TR1  = 1;     //¿ªÆô¶¨Ê±Æ÷ÖÐ¶Ï1
 941   3                              TR0  = 1;     //¿ªÆô¶¨Ê±Æ÷ÖÐ¶Ï0
 942   3                              EADC = 1;         //¿ªÆôADC 
 943   3                                  ADC_Count=0;
 944   3                                  while(ADC_Count<128); //×ª»»128´Î
 945   3                                      for(i=0;i<128;i++)        //FFT²ÎÊýÐé²¿¸³Öµ
 946   3                                      {
 947   4                                              Fft_Image[i]=0;   //Ô­Ê¼Êý¾Ý Ðé²¿¸³ÖµÎª0
 948   4                                      }
 949   3                                      FFT();                //FFTÔËËã²¢×ª»»Îª¸÷Æµ¶Î·ùÖµ
 950   3                              
 951   3                 }
 952   2              }
 953   1      }
 954          
 955          
 956          
 957          void time1() interrupt 3
 958          {
 959   1         if(flag==2)
 960   1         {
 961   2          TH1  = 0xfd; //Ë¢ÐÂÏÔÊ¾ÖÜÆÚ£¨300us»ò25us£©  Ë¢ÐÂÂÊ                                                                             
 962   2              TL1  = 0Xa8; //
 963   2              G++;                                                    
 964   2              if(G>=17) G=1;
 965   2              switch(G)                                                                    //ÍùµãÕóÆÁÌî³äÒ»ÁÐµÄÊý¾Ý
 966   2              {               
 967   3                      case 1: P2=tablew[(LED_TAB[0])%8];gaodu(0x80);break;     //(LED_TAB[1] )%8È¡°ËµÄÓàÊý
 968   3                      case 2: P2=tablew[(LED_TAB[1])%8];gaodu(0x80);break;
 969   3                      case 3: P2=tablew[(LED_TAB[2])%8];gaodu(0x40);break;
 970   3                      case 4: P2=tablew[(LED_TAB[3])%8];gaodu(0x40);break;
 971   3                      case 5: P2=tablew[(LED_TAB[4])%8];gaodu(0x20);break;
 972   3                      case 6: P2=tablew[(LED_TAB[5])%8];gaodu(0x20);break;
 973   3                      case 7: P2=tablew[(LED_TAB[6])%8];gaodu(0x10);break;
 974   3                      case 8: P2=tablew[(LED_TAB[7])%8];gaodu(0x10);break;
 975   3                      case 9: P2=tablew[(LED_TAB[8])%8];gaodu(0x08);break;
 976   3                      case 10:P2=tablew[(LED_TAB[9])%8];gaodu(0x08);break;
 977   3                      case 11:P2=tablew[(LED_TAB[10])%8];gaodu(0x04);break;
 978   3                      case 12:P2=tablew[(LED_TAB[11])%8];gaodu(0x04);break;
 979   3                      case 13:P2=tablew[(LED_TAB[12])%8];gaodu(0x02);break;
 980   3                      case 14:P2=tablew[(LED_TAB[13])%8];gaodu(0x02);break;
 981   3                      case 15:P2=tablew[(LED_TAB[14])%8];gaodu(0x01);break;
 982   3                      case 16:P2=tablew[(LED_TAB[15])%8];gaodu(0x01);break;
 983   3              }
C51 COMPILER V8.05a   LEDCUBE                                                              11/06/2018 21:33:31 PAGE 17  

 984   2              P2=0X00;        
 985   2         }
 986   1         else
 987   1         {
 988   2                 TH1=(65536-2000)/256;
 989   2                 TL1=(65536-2000)%256;
 990   2                 tim1++;
 991   2         }
 992   1      }
 993          void ADC_Finish() interrupt 5
 994          {          
 995   1              ADC_CONTR &= !ADC_FLAG; 
 996   1              Fft_Real[LIST_TAB[ADC_Count]] =(int)((ADC_RES)<<1)+(ADC_RESL>>1)*2;     //°´LIST_TAB±íÀïµÄË³Ðò£¬½øÐÐ´æ´¢²
             -ÉÑùÖµ
 997   1              if(ADC_Count<=127)
 998   1               { ADC_Count++;  }
 999   1              else              
1000   1               { EADC=0;TR0=0; }                                                                                                               
1001   1      }
1002          void Ad_Control() interrupt 1                                    
1003          {                               
1004   1              //¿ØÖÆ²ÉÑùËÙÂÊ
1005   1              if(flag==2)
1006   1              {
1007   2                      ADC_CONTR = ADC_POWER | ADC_SPEEDHH| ADC_START | channel; //¿ªÊ¼AD²É¼¯
1008   2              }
1009   1              if(flag==1 || flag==3)
1010   1              { 
1011   2           TH0=(65536-2000)/256;
1012   2           TL0=(65536-2000)%256;
1013   2           tim0++;    
1014   2              }
1015   1              if(flag==0||flag==4);
1016   1      } 


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   5380    ----
   CONSTANT SIZE    =    400    ----
   XDATA SIZE       =    528    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     32     110
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
